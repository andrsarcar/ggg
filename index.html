<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Собери число</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:Arial,sans-serif;background:#f0f0f0;user-select:none;-webkit-tap-highlight-color:transparent;overflow-x:hidden;width:100vw}
#game{max-width:100%;padding:10px;margin:0 auto}
#targetInput{width:100%;font-size:24px;padding:12px;margin:8px 0;border:2px solid #999;background:#fff;text-align:center}
.keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin:12px 0}
.keypad button{font-size:22px;padding:16px;border:2px solid #999;background:#fff;touch-action:manipulation}
.buttons{display:flex;gap:8px;margin:12px 0}
.buttons button{flex:1;padding:12px;font-size:16px;border:2px solid #999;background:#ddd;touch-action:manipulation}
#numbers{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin:15px 0}
#numbers div{padding:20px;font-size:24px;background:#fff;border:2px solid #999;text-align:center;touch-action:manipulation}
#current{margin:10px 0;font-size:20px;text-align:center}
#result{margin:10px 0;font-size:20px;text-align:center;min-height:30px;font-weight:bold}
h3{font-size:22px;text-align:center;margin:5px 0}
#expression{text-align:center;margin:10px 0;font-size:20px}
</style>
</head>
<body>
<div id="game">
<h3>Собери число</h3>
<input type="number" id="targetInput" placeholder="Введите число" inputmode="numeric" max="999999999">
<div class="keypad">
<button onclick="add('7')">7</button><button onclick="add('8')">8</button><button onclick="add('9')">9</button>
<button onclick="add('4')">4</button><button onclick="add('5')">5</button><button onclick="add('6')">6</button>
<button onclick="add('1')">1</button><button onclick="add('2')">2</button><button onclick="add('3')">3</button>
<button onclick="add('0')">0</button><button onclick="clr()">C</button><button onclick="del()">⌫</button>
</div>
<div class="buttons">
<button onclick="start()">ГОТОВО</button>
<button onclick="check()">ПРОВЕРИТЬ</button>
<button onclick="reset()">НОВАЯ</button>
</div>
<div id="current">Цель: <span id="target">-</span></div>
<div id="numbers"></div>
<div id="expression">Сумма: <span id="sum">0</span></div>
<div id="result"></div>
</div>
<script>
let target=0,nums=[],sum=0,used=[]

function add(d){
    let input = document.getElementById('targetInput')
    let current = input.value
    if(current.length < 9) {
        input.value += d
    }
}

function clr(){
    document.getElementById('targetInput').value=''
}

function del(){
    let i=document.getElementById('targetInput')
    i.value=i.value.slice(0,-1)
}

function start(){
    let v=document.getElementById('targetInput').value
    let num = parseInt(v)
    
    if(isNaN(num) || num < 1){
        target = 100
        document.getElementById('targetInput').value = '100'
    } else if(num > 999999999){
        target = 999999999
        document.getElementById('targetInput').value = '999999999'
    } else {
        target = num
    }
    
    document.getElementById('target').textContent = target
    
    // ГЕНЕРАЦИЯ ЧИСЕЛ, КОТОРЫЕ ТОЧНО МОЖНО СОБРАТЬ
    nums = []
    
    if(target <= 10){
        // Для маленьких чисел
        for(let i=0; i<6; i++){
            nums.push(Math.floor(Math.random() * target) + 1)
        }
        nums[0] = 1
        nums[1] = Math.floor(target/2) || 1
    } else if(target <= 100){
        // Для средних чисел
        let parts = [10, 25, 50, 75]
        for(let i=0; i<4; i++){
            if(parts[i] <= target) nums.push(parts[i])
        }
        while(nums.length < 6){
            let r = Math.floor(Math.random() * (target/2)) + 1
            if(!nums.includes(r)) nums.push(r)
        }
    } else {
        // Для больших чисел - создаем делители и кратные числа
        let found = false
        let attempts = 0
        
        while(!found && attempts < 100){
            nums = []
            let remaining = target
            
            // Первые 4 числа - это части target
            for(let i=0; i<4; i++){
                if(remaining <= 0) break
                let maxPart = Math.floor(remaining / (4-i))
                if(maxPart < 1) maxPart = 1
                let part = Math.floor(Math.random() * maxPart) + 1
                nums.push(part)
                remaining -= part
            }
            
            // Добавляем 5-е число как оставшуюся часть
            if(remaining > 0){
                nums.push(remaining)
            } else {
                nums.push(Math.floor(target/10) || 1)
            }
            
            // 6-е число случайное
            nums.push(Math.floor(Math.random() * (target/5)) + 1)
            
            // Проверяем, что сумма всех чисел >= target
            let total = nums.reduce((a,b) => a + b, 0)
            if(total >= target){
                found = true
                
                // Перемешиваем
                for(let i=nums.length-1; i>0; i--){
                    let j=Math.floor(Math.random()*(i+1))
                    let temp=nums[i]
                    nums[i]=nums[j]
                    nums[j]=temp
                }
            }
            attempts++
        }
        
        // Если не удалось найти подходящие числа, создаем простые
        if(!found){
            nums = [
                Math.floor(target/4) || 1,
                Math.floor(target/3) || 1,
                Math.floor(target/2) || 1,
                Math.floor(target*2/3) || 1,
                Math.floor(target/5) || 1,
                Math.floor(target/6) || 1
            ]
        }
    }
    
    // Убедимся, что все числа положительные
    nums = nums.map(n => Math.max(1, n))
    
    render()
    sum=0
    used=[]
    document.getElementById('sum').textContent=sum
    document.getElementById('result').textContent=''
}

function render(){
    let c=document.getElementById('numbers')
    c.innerHTML=''
    nums.forEach((n,i)=>{
        let d=document.createElement('div')
        d.textContent=n
        d.onclick=()=>{
            if(!used.includes(i)){
                used.push(i)
                sum+=n
                document.getElementById('sum').textContent=sum
                d.style.backgroundColor='#e0e0e0'
                d.style.opacity='0.7'
            }
        }
        c.appendChild(d)
    })
}

function check(){
    let r=document.getElementById('result')
    if(sum === target){
        r.textContent='✓ Верно!'
        r.style.color='green'
    }else{
        let diff = Math.abs(target - sum)
        r.textContent='✗ Нужно: '+target+' (у вас: '+sum+', разница: '+diff+')'
        r.style.color='red'
    }
}

function reset(){
    clr()
    document.getElementById('target').textContent='-'
    document.getElementById('numbers').innerHTML=''
    document.getElementById('sum').textContent='0'
    document.getElementById('result').textContent=''
    sum=0
    used=[]
}

document.getElementById('targetInput').onkeyup=function(e){
    if(e.key==='Enter') start()
}

document.getElementById('targetInput').oninput=function(){
    if(this.value.length > 9){
        this.value = this.value.slice(0,9)
    }
}
</script>
</body>
</html>